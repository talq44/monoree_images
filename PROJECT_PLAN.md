# 로컬 AI 이미지 일괄 생성 스크립트

## 1. 프로젝트 목표

- 텍스트 파일에 정의된 목록을 기반으로, Gemini AI를 사용하여 이미지를 일괄적으로 자동 생성하는 쉘 스크립트를 개발한다.
- 이 스크립트는 로컬 환경에서 실행되며, 복잡한 설정 없이 몇 가지 입력만으로 이미지 생성을 자동화하는 것을 목표로 한다.

## 2. 스크립트 동작 순서

스크립트를 실행하면 다음 6단계의 입력을 순차적으로 받는다.

### 1단계: 대상 목록 파일 입력

- **설명:** 이미지 생성의 기반이 될 이름 목록이 포함된 텍스트 파일의 이름을 입력받는다. (예: `animals.txt`)
- **요구사항:**
    - 스크립트와 동일한 디렉토리에 위치해야 한다.
    - 파일 안에는 각 줄마다 하나의 이름(ID)이 있어야 한다.

### 2단계: 작업 이름(폴더명) 입력

- **설명:** 생성된 이미지를 저장할 폴더의 이름을 입력받는다. (예: `toy3d_animals`)
- **동작:** 스크립트는 현재 디렉토리에 해당 이름으로 새 폴더를 생성한다.

### 3단계: 이미지 타입 선택

- **설명:** 생성할 이미지의 파일 형식을 선택한다.
- **옵션:**
    1.  `png`
    2.  `jpeg`
    3.  `webp`
- 사용자는 1, 2, 3 중 하나의 숫자를 입력한다.

### 4단계: 프롬프트 템플릿 입력

- **설명:** 이미지 생성을 위한 프롬프트(명령어) 템플릿을 입력받는다.
- **필수 요소:**
    - 템플릿에는 반드시 `{id}` 플레이스홀더가 포함되어야 한다.
    - 이 `{id}`는 **1단계**에서 입력한 파일의 각 줄에 있는 이름으로 자동 대체된다.
- **입력 예시:** `A {id} in a toy3d style, clean background.`

### 5단계: 이미지 생성 서비스 선택

- **설명:** 사용할 이미지 생성 서비스를 선택한다. (예: `Gemini`, `GPT`)
- **동작:** 선택된 서비스에 따라 이후 단계에서 필요한 추가 정보(모델, API 키 등)가 달라진다.
- **요구사항:** 각 서비스의 사용 조건(Gemini 유료 모델, GPT 사용 가능 지역/한도 등)을 미리 안내한다.

### 6단계: 서비스별 API 토큰 입력

- **설명:** 선택한 서비스에서 요구하는 API 키를 입력받는다.
    - 예를 들어 `Gemini`를 선택하면 Gemini API Key, `GPT`를 선택하면 OpenAI API Key.
- **보안:** 입력된 토큰은 화면에 표시되지 않도록 처리한다.

> **참고:** 스크립트는 두 서비스를 모두 지원하도록 설계하며, 향후 다른 이미지 모델도 쉽게 추가할 수 있도록 모듈화한다.


## 3. 핵심 실행 로직

1.  모든 입력이 완료되면, 스크립트는 **1단계**의 파일을 한 줄씩 읽어들인다.
2.  각 줄의 내용(`{id}`)을 **4단계**의 프롬프트 템플릿에 삽입하여 완전한 프롬프트를 생성한다.
3.  **5단계**에서 선택한 서비스에 맞는 이미지 생성 API를 호출한다.
    - Gemini 선택 시: 기존 로직(모델 목록 조회 → 모델 선택 → API 호출)을 따른다.
    - GPT 선택 시: OpenAI 이미지 생성 API(예: `images.generate`)를 사용하며, 대응되는 모델/사이즈 옵션을 제공한다.
4.  API로부터 이미지 데이터를 성공적으로 받으면, **2단계**에서 생성한 폴더 내에 `{id}.[선택한 확장자]` 형식의 파일 이름으로 저장한다.
5.  하나의 이미지 생성이 완료되면, 다음 이미지 생성을 시작하기 전에 **최소 1분의 딜레이**를 가진다. 이는 API의 과도한 사용 제한을 피하기 위함이다. (예: `sleep 60`)
6.  파일의 모든 줄에 대한 작업이 끝날 때까지 위 과정을 반복한다.

## 4. 안정성 및 사용성 개선

### 4.1. 입력값 검증

- **파일 존재 확인:** 1단계에서 입력받은 파일이 실제로 존재하는지 확인하고, 없으면 오류 메시지와 함께 다시 입력받는다.
- **프롬프트 형식 확인:** 4단계에서 입력받은 프롬프트 템플릿 안에 `{id}` 플레이스홀더가 포함되어 있는지 검사한다. 없으면 경고 후 다시 입력받는다.

### 4.2. 실행 로그 출력

- **진행 상황 알림:** "총 50개 중 3번째 '사자' 이미지 생성 중..." 과 같이 현재 진행 상태를 터미널에 실시간으로 출력하여 사용자가 대기 상황을 인지할 수 있도록 한다.
- **결과 로그:** 각 항목에 대한 이미지 생성 성공 또는 실패 여부를 명확히 출력한다. (예: "성공: lion.webp 저장 완료", "실패: tiger - API 오류 발생")

### 4.3. 오류 처리 및 건너뛰기

- **API 오류 처리:** API 호출이 실패했을 경우(네트워크 문제, API 키 오류, 유해 콘텐츠 차단 등), 스크립트를 중단하지 않고 해당 항목을 건너뛴다.
- **오류 기록:** 실패한 항목의 ID와 실패 사유를 별도의 로그 파일(`error.log`)에 기록하여 나중에 사용자가 원인을 파악하고 재시도할 수 있도록 돕는다.
- **파일 이름 정제 (Sanitization):** ID에 파일명으로 사용할 수 없는 문자(공백, `/` 등)가 포함된 경우, 이를 `_` 등으로 자동 치환하여 파일 저장 시 발생할 수 있는 오류를 사전에 방지한다.

### 4.4. 재시작 기능 (이어하기)

- **기존 파일 확인:** 스크립트가 시작될 때, 2단계에서 지정한 폴더를 먼저 확인한다.
- **건너뛰기 로직:** 폴더 내에 이미 해당 ID로 생성된 파일(예: `lion.webp`)이 존재할 경우, 해당 ID에 대한 API 호출 및 이미지 생성을 건너뛰고 다음 항목으로 바로 넘어간다. 이를 통해 작업이 중단되었을 때 처음부터 다시 시작할 필요 없이 중단된 지점부터 효율적으로 작업을 재개할 수 있다.

## 5. 기술 요구사항

- **실행 환경:** `bash` 또는 `zsh` 쉘
- **필수 명령어:**
    - `curl`: Gemini/GPT API 호출에 공통으로 사용.
    - `jq` (선택적): API 응답(JSON)을 파싱하기 위해 사용하면 편리하다.
- **준비물:**
    - 선택한 서비스에 맞는 유효한 API Key (예: Gemini API Key, OpenAI API Key).
    - 이미지로 만들 이름들이 담긴 텍스트 파일.
